{% extends 'base.html.twig' %}

{% block title %}Taks{% endblock %}

{% block nav_tasks %} class="active" {% endblock %}
{% block nav_home %} {% endblock %}
{% block body %}

    <div class="row">
        <div class="col-md-4">
                <h1>Asignacion # <span id="asignacion"></span></h1>
        </div>
        {% if is_granted("ROLE_TECNICO") %}
        <div class="col-md-4">
            <h3 ><span id="fecha"></span> <button onclick="cambiarEstado()" id="bestado" class="btn btn-sm"><span id="estado"></span></button></h3>
        </div>
        {% endif %}
    </div>
    <a href="" class="btn btn-primary btn-sm">PENDIENTE</a>
    <div class="row">
        <div class="col-md-6">
            <div class="row">
                <div class="col-md-4">
                    {% if is_granted('ROLE_NORMAL') %}
                         <h4>Asignacion A : </h4>
                    {% endif %}
                    {% if is_granted('ROLE_TECNICO') %}
                        <h4>Asignacion Por : </h4>
                    {% endif %}
                    <h4>Descripcion : </h4>
                </div>
                <div class="col-md-8">
                    {% if is_granted('ROLE_NORMAL') %}
                        <h4 id="asignado_a"></h4>
                    {% endif %}
                    {% if is_granted('ROLE_TECNICO') %}
                        <h4 id="asignado_por"></h4>
                    {% endif %}
                    <p id="descripcion"> </p>
                </div>
            </div>
        </div>
        <div class="col-md-4 col-md-offset-2">

            <label>Notas     <a href="" class="btn btn-success btn-sm">Agregar Nota</a></label>
            <table id="table" class="table table-striped table-hover table-responsive table-condensed">
                <thead>
                <tr>
                    <th>Usuario</th>
                    <th>Fecha</th>
                    <th>Nota</th>
                </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Juan P</td>
                        <td>11/07/2018</td>
                        <td>Porque no termina</td>
                    </tr>
                    <tr>
                        <td>Juan P</td>
                        <td>11/07/2018</td>
                        <td>Porque no termina</td>
                    </tr>
                    <tr>
                        <td>Juan P</td>
                        <td>11/07/2018</td>
                        <td>Porque no termina</td>
                    </tr>
                    <tr>
                        <td>Juan P</td>
                        <td>11/07/2018</td>
                        <td>Porque no termina</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <input type="hidden" class="hidden" value="{{ id }}" id="ticket">
    {% block js %}

        <script>
                function getTableTask(){
                    var id=$('#ticket').val();
                    $.ajax({
                        url: Routing.generate('rest_ver_task', {id : id}),
                        type: 'GET',
                        success:function (response) {

                            $("#asignado_a").html(response.usuarioAsignado.nombre);
                            $("#descripcion").html(response.descripcion);
                            $("#fecha").html(new Date(response.fechaCreado.timestamp*1000));
                            $("#asignacion").html(response.id);
                            $("#asignado_por").html(response.usuario.nombre);

                            console.log(response.estado);
                            if (response.estado=="EN_PROCESO") {
                                $("#estado").html(response.estado);
                                $("#bestado").removeClass("btn-primary").addClass(" btn-warning");
                            }else if(response.estado=="LISTO") {
                                $("#estado").html(response.estado);
                                $("#bestado").removeClass("btn-warning").addClass("disabled");
                            }else{
                                $("#estado").html(response.estado);
                                $("#bestado").addClass(" btn-primary");

                            }

                        }

                    });

                }

                function cambiarEstado(){
                    var estado=$("#estado").html();
                    var id=$("#asignacion").html();
                    console.log(estado);
                    var data={
                        estado:estado
                    };
                    $.ajax({
                        url:Routing.generate('rest_update_ticket', {id : id}),
                        type: 'PUT',
                        data: JSON.stringify(data),
                        success: function (response) {
                            console.log(response);
                        }  ,
                        error: function (err) {
                            console.log(err);
                        }
                    });
                    getTableTask();
                }
                getTableTask();

        </script>
    {% endblock %}

{% endblock %}